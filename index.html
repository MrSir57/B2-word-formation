<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Word Formation Game</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 600px; margin: 50px auto; position: relative; text-align: center; }
        .card { border: 2px solid #ccc; padding: 20px; border-radius: 10px; position: relative; }
        .feedback { margin-top: 10px; font-weight: bold; }
        .hidden { display: none; }
        .correct { color: green; }
        .incorrect { color: red; }
        #badge { font-size: 1.5em; margin-top: 10px; }
        .confetti { position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 9999; }
        #logo { width: 100px; animation: bob 2s infinite ease-in-out; margin-bottom: 20px; }
        @keyframes bob { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-10px); } }
        #start-screen { }
        #game-screen { display: none; }
        #playerNameForm { }
        #gameContent { display: none; }
    </style>
</head>
<body>
    <div id="start-screen">
        <h1>Welcome to the Word Formation Game!</h1>
        <p>Form words based on the prompts.</p>
        <button id="initial-start-button">Start Game</button>
    </div>

    <div id="game-setup" class="hidden card">
        <img src="logo.jpg" id="logo" alt="Logo">
        <div id="playerNameForm">
            <h2>Word Formation Game</h2>
            <label for="playerNameInput">Enter your name to start:</label>
            <input type="text" id="playerNameInput" placeholder="Your name here" />
            <button id="start-game-button">Start Game</button>


            

            
        </div>
    </div>

    <div id="gameContent" class="hidden card">
        <h2>Word Formation Exercise (B2)</h2>
        <p><strong>Player:</strong> <span id="playerName"></span></p>
        <p id="question"></p>
        <input type="text" id="answer" placeholder="Your answer here" />
        <button onclick="checkAnswer()">Submit</button>
        <button onclick="nextQuestion()" class="hidden" id="nextBtn">Next</button>
        <button onclick="showAnswer()" class="hidden" id="showAnswerBtn">Show Answer</button>
        <div class="feedback" id="feedback"></div>
        <p>Score: <span id="score">0</span> | Attempts: <span id="attempts">0</span></p>
        <div id="badge"></div>
    </div>

    <div id="end-screen" class="hidden">
        <h2>Game Over!</h2>
        <p>Your final score is: <span id="final-score"></span> / <span id="final-total-questions"></span></p>
        <button id="restart-button">Play Again</button>
    </div>

    <div id="badge" class="hidden">üèÜ Well done! üèÜ</div>
    <canvas id="confetti" class="confetti hidden"></canvas>

    <script>
        const initialStartButton = document.getElementById('initial-start-button');
        const startScreen = document.getElementById('start-screen');
        const gameSetup = document.getElementById('game-setup');
        const startGameButton = document.getElementById('start-game-button');
        const gameContent = document.getElementById('gameContent');
        const playerNameDisplay = document.getElementById('playerName');
        const questionDisplay = document.getElementById('question');
        const answerInput = document.getElementById('answer');
        const submitButton = document.querySelector('#gameContent button[onclick="checkAnswer()"]');
        const nextButton = document.getElementById('nextBtn');
        const showAnswerButton = document.getElementById('showAnswerBtn');
        const feedbackDisplay = document.getElementById('feedback');
        const scoreDisplay = document.getElementById('score');
        const attemptsDisplay = document.getElementById('attempts');
        const badgeDisplay = document.getElementById('badge');
        const confettiCanvas = document.getElementById('confetti');

        const allQuestions = [
            { text: "He gave us a detailed ____________________ of how the accident happened. (DESCRIBE)", answer: "description" },
            { text: "He moved to the United ____________________ a few years ago. (KING)", answer: "kingdom" },
            { text: "She has been doing research work as a ____________________. (SCIENCE)", answer: "scientist" },
            { text: "I wanted to ____________________ but Dad cut me off at once. (APOLOGY)", answer: "apologise" },
            { text: "Most bird species are under ____________________ by law. (PROTECT)", answer: "protection" },
            { text: "We enjoyed the ____________________ of the ski hut at night. (WARM)", answer: "warmth" },
            { text: "He is the most famous ____________________ who has ever had an exhibition in this gallery. (ART)", answer: "artist" },
            { text: "After his mother's ____________________ he moved to South America. (DIE)", answer: "death" },
            { text: "I didn't tell him the whole ____________________. (TRUE)", answer: "truth" },
            { text: "Who was the last Roman ____________________? (EMPIRE)", answer: "emperor" },
            { text: "Can you tell me the ____________________ of the new restaurant? (LOCATE)", answer: "location" },
            { text: "The hotel offers a great ____________________ of activities tourists can do. (SELECT)", answer: "selection" },
            { text: "The view from the top of the mountain is absolutely ____________________. (FASCINATE)", answer: "fascinating" },
            { text: "____________________, we didn't get caught cheating. (LUCK)", answer: "luckily" },
            { text: "He likes reading ____________________. (POEM)", answer: "poetry" },
            { text: "Even the FBI could not solve the ____________________ crime. (MYSTERY)", answer: "mysterious" },
            { text: "She runs a ____________________ business in Los Angeles. (SUCCEED)", answer: "successful" },
            { text: "They are doing some research on the ____________________ of nuclear weapons. (DESTROY)", answer: "destruction" },
            { text: "____________________ is a characteristic that many politicians lack. (HONEST)", answer: "honesty" },
            { text: "Mum didn't go up to the top because she is afraid of ____________________. (HIGH)", answer: "heights" },
            { text: "It has snowed ____________________ in the last 24 hours. (CONSIDER)", answer: "considerably" },
            { text: "We were ____________________ that our mother would survive surgery and get better soon. (HOPE)", answer: "hopeful" },
            { text: "There were a lot of ____________________ parts that she did not understand. (MEANING)", answer: "meaningless" },
            { text: "After a few days, the family reported the ____________________ to the police. (APPEAR)", answer: "disappearance" },
            { text: "We still didn't know the ____________________ of the refugees. (NATION)", answer: "nationality" },
            { text: "__________________ people are not always the happiest. (WEALTH)", answer: "wealthy" },
            { text: "There was an ____________________ line of cars waiting to cross the border. (END)", answer: "endless" },
            { text: "He runs a ____________________ restaurant near the beach. (FASHION)", answer: "fashionable" },
            { text: "The new cars are equipped with very ____________________ engines. (POWER)", answer: "powerful" },
            { text: "It was at a very early age that she decided to become a ____________________. (MUSIC)", answer: "musician" },
            { text: "She deserved the ____________________ she was given by the headmistress. (PUNISH)", answer: "punishment" },
            { text: "The refugees got ____________________ from the local police force. (PROTECT)", answer: "protection" },
            { text: "____________________, a number of people died in the accident. (FORTUNATE)", answer: "unfortunately" },
            { text: "It was very ____________________ at the disco, so we decided to go somewhere else. (NOISE)", answer: "noisy" },
            { text: "We ____________________ eat out. In most cases we get some takeaway food. (RARE)", answer: "rarely" },
            { text: "There are thousands of ____________________ people in the large cities of the world. (HOME)", answer: "homeless" },
            { text: "Use your ____________________ and think of something that will work. (IMAGINE)", answer: "imagination" },
            { text: "If you accept this job you will have an enormous ____________________ towards your colleagues. (RESPONSIBLE)", answer: "responsibility" },
            { text: "The test was ____________________ easy. We were finished in no time. (SURPRISE)", answer: "surprisingly" },
            { text: "The pupils thought they were treated ____________________ by the teacher. (FAIR)", answer: "unfairly" },
            { text: "She didn't give us any information that turned out to be very ____________________. (USE)", answer: "useful" },
            { text: "The politician's ____________________ did not come to the event. (SUPPORT)", answer: "supporters" },
            { text: "It was ____________________ to see anything in the thick fog. (POSSIBLE)", answer: "impossible" },
            { text: "There are ____________________ methods of succeeding. (VARY)", answer: "various" },
            { text: "The train was very ____________________, and we had to stand. (CROWD)", answer: "crowded" },
            { text: "He took a lot of ____________________ with him because it would be a long expedition. (EQUIP)", answer: "equipment" },
            { text: "I ____________________ eating alone. I always have to have someone to talk to. (LIKE)", answer: "dislike" },
            { text: "The student council provided financial and ____________________ help for new students. (PRACTICE)", answer: "practical" },
            { text: "The newspaper is delivered to my doorstep ____________________ at 5 in the morning. (REGULAR)", answer: "regularly" },
            { text: "The drive up to the mountains ended with a ____________________ view of the sea. (FANTASY)", answer: "fantastic" }
        ];

        let questions;
        let current = 0;
        let attempts = 0;
        let totalAttempts = 0;
        let score = 0;
        let playerName = "";

        window.addEventListener("DOMContentLoaded", () => {
            questions = allQuestions.sort(() => 0.5 - Math.random()).slice(0, 15);
            // Initially show only the very first start screen
            gameSetup.classList.add('hidden');
            gameContent.classList.add('hidden');
        });

        initialStartButton.addEventListener('click', () => {
            startScreen.classList.add('hidden');
            gameSetup.classList.remove('hidden');
        });

        startGameButton.addEventListener('click', () => {
    console.log('startGameButton clicked');
    const input = document.getElementById("playerNameInput").value.trim();
    console.log('Player name:', input);
    if (input) {
        playerName = input;
        console.log('playerName set:', playerName);
        console.log('playerNameDisplay:', playerNameDisplay); // Check if this is a valid element
        if (playerNameDisplay) playerNameDisplay.textContent = playerName;
        console.log('playerNameDisplay updated');
        console.log('gameSetup:', gameSetup); // Check if this is a valid element
        if (gameSetup) gameSetup.classList.add("hidden");
        console.log('gameSetup hidden');
        console.log('gameContent:', gameContent); // Check if this is a valid element
        if (gameContent) gameContent.classList.remove("hidden");
        console.log('gameContent shown');
        loadQuestion();
        console.log('loadQuestion called');
    } else {
        alert("Please enter your name to start the game.");
    }
     
        function loadQuestion() {
            questionDisplay.textContent = questions[current].text;
            answerInput.value = "";
            feedbackDisplay.textContent = "";
            feedbackDisplay.className = "feedback";
            attemptsDisplay.textContent = "0";
            showAnswerButton.classList.add("hidden");
            nextButton.classList.add("hidden");
            badgeDisplay.textContent = "";
            attempts = 0;
        }

        function checkAnswer() {
            const userInput = answerInput.value.trim().toLowerCase();
            const feedback = feedbackDisplay;

            // Prevent multiple correct submissions on same question
            if (nextButton.classList.contains("hidden") === false) {
                feedback.textContent = "‚úîÔ∏è You've already answered correctly. Click Next to continue.";
                return;
            }

            attempts++;
            totalAttempts++;
            attemptsDisplay.textContent = attempts;

            if (userInput === questions[current].answer) {
                feedback.textContent = "‚úÖ Correct! Well done.";
                feedback.className = "feedback correct";
                if (attempts === 1) score += 2;
                else if (attempts === 2) score += 1;
                scoreDisplay.textContent = score;
                nextButton.classList.remove("hidden");
                showAnswerButton.classList.add("hidden");
                if (score >= 25) badgeDisplay.textContent = "üèÜ Word Master!";
            } else {
                feedback.textContent = "‚ùå Not quite. Try again!";
                feedback.className = "feedback incorrect";
                if (attempts === 2) {
                    showAnswerButton.classList.remove("hidden");
                }
            }
        }

        function showAnswer() {
            const feedback = feedbackDisplay;
            feedback.textContent = `üí° The correct answer is: ${questions[current].answer}`;
            feedback.className = "feedback";
            nextButton.classList.remove("hidden");
            showAnswerButton.classList.add("hidden");
        }

        function nextQuestion() {
            current++;
            if (current < questions.length) {
                loadQuestion();
            } else {
                endGame();
            }
        }

        function endGame() {
            try {
                sendScoreToGoogleSheet(playerName, score, totalAttempts);
            } catch (e) {
                console.warn("Skipping score submission (offline or restricted environment)");
            }
            document.body.innerHTML = `
                <div class="card">
                    <h2>üèÅ Game Over</h2>
                    <p><strong>${playerName}</strong>, your final score is <strong>${score}</strong> in <strong>${totalAttempts}</strong> total attempts.</p>
                    <p>üîù <strong>Leaderboard</strong></p>
                    <iframe src="https://docs.google.com/spreadsheets/d/e/2PACX-1vQksVZZ4RXH-N1HESjz9bqir_OJemWKeTUwV6wM1y30pTDa1H8xET4zCE/pubhtml?widget=true&amp;headers=false" width="100%" height="400"></iframe>
                    <p><button onclick="location.reload()">üîÅ Play Again</button></p>
                </div>
            `;
        }

        function sendScoreToGoogleSheet(name, score, attempts) {
            if (!navigator.onLine) {
                throw new Error("Offline mode: cannot send score");
            }
            fetch("https://script.google.com/macros/s/AKfycbxnYY0oIDGnUXvUMlz9gr53GmHsHL7nEXvAeviSoALFJsX78W_HtwdwsGZKFpgDATw/exec", {
                method: "POST",
                body: JSON.stringify({ name, score, attempts }),
                headers: {
                    "Content-Type": "application/json"
                }
            })
            .then(response => response.text())
            .then(result => console.log("Score submitted:", result))
            .catch(error => console.warn("Error sending score (likely offline or sandboxed environment):", error));
        }
    </script>
</body>
</html>
